{{ $url := urls.Parse .Destination }}
{{ $scheme := $url.Scheme }}
{{ $final_url := $url.Scheme }}

<img src="{{ if not $url.IsAbs }}{{ if strings.HasSuffix $url.Path ".md" }}{{ relref . .Destination | safeURL }}{{ else }}{{ relURL .Destination | safeURL }}{{ end }}{{ else }}{{ .Destination | safeURL }}{{ end }}"
  {{ with .Title }} title="{{ . | safeHTML }}" {{ end }}
  {{ with .Text }} alt="{{ . | safeHTML }}" {{ end }}
/>

{{- /* whitespace stripped here to avoid trailing newline in rendered result caused by file EOL */ -}}